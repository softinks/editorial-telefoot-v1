(e=>{e.lib=Object.assign(e.lib||{},(()=>{const e=async(e,t,s,o,i)=>new Promise((n,a)=>{let r=null;try{if(r=new XMLHttpRequest,s&&Object.keys(s).length&&(t+=`?${Object.keys(s).filter(e=>!!s[e]).map(e=>`${e}=${s[e]}`).join("&")}`),r.open(e,t,!0),!i||o&&o["Content-Type"]||r.setRequestHeader("Content-Type","application/json; charset=utf-8"),o)for(let e in o)r.setRequestHeader(e,o[e]);r.onload=(e=>{let t=null;try{t=r.response?JSON.parse(r.response):null}catch(e){t=null}n({statusCode:r.status,body:t})}),r.onerror=(e=>{a(e)}),i?r.send(JSON.stringify(i)):r.send()}catch(e){a(e)}});return{api:({url:t,query:s=null,headers:o=null})=>({get:e.bind(null,"GET",t,s,o,null),post:e.bind(null,"POST",t,s,o),put:e.bind(null,"PUT",t,s,o),delete:e.bind(null,"DELETE",t,s,o),head:e.bind(null,"HEAD",t,s,o,null),patch:e.bind(null,"PATCH",t,s,o)})}})())})(window),(window=>{window.lib=Object.assign(window.lib||{},(()=>({browser:{supports(value){if("es6"===value){try{return 1===eval("((x)=>x+1)(0)")}catch(e){return!1}return!0}return"IntersectionObserver"===value&&"IntersectionObserver"in window},isSupported(){const e=window.navigator.userAgent?window.navigator.userAgent.toLowerCase():null;let t=!0;try{CSS.supports("(display:flex)")?"".padStart?e&&e.includes("msie")?(lib.log.debug(`[SUPPORT] MSIE not supported => ${e}`),t=!1):e&&e.includes("edge/")?(lib.log.debug(`[SUPPORT] Edge (old) not supported => ${e}`),t=!1):window.navigator.vendor&&window.navigator.vendor.includes("Apple")&&window.navigator.userAgent&&/version\/(11\.|10\.|9\.|8\.|7\.|6\.|5\.)/.test(window.navigator.userAgent.toLowerCase())&&(lib.log.debug(`[SUPPORT] Safari (old) not supported => ${e}`),t=!1):(lib.log.debug(`[SUPPORT] padStart not supported => ${e}`),t=!1):(lib.log.debug("[SUPPORT] flex not supported"),t=!1)}catch(e){t=!1}t||(window.lib.log.warning("[BROWSER] not supported"),window.lib.modal.show({type:"browserNotSupported"}),window.lib.log.disable())}}}))())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{const e=`${SETTINGS.BASE_URL}/api/v1`,t=({token:e})=>({"X-Authorization":`Basic ${btoa(e)}`});return{content:{getDynamicData:async({token:e,uuid:s,url:o})=>{let i=null,n=null,a=null,r=null;e&&(r=t({token:e})),s&&(o=o.replace(/{uuid}/g,s)),lib.log.debug(`[CONTENT.getDynamicData}] => ${o} (${JSON.stringify(r)})`);try{if(401===(i=await lib.api({url:o,headers:r}).get()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(r=t({token:e.token}),i=await lib.api({url:o,headers:r}).get())}}catch(e){lib.log.error(`[CONTENT.getDynamicData] KO ${o} => ${e.message||e.toString()}`)}return i&&(200!==(n=i.statusCode)?lib.log.warning(`[CONTENT.getDynamicData] KO ${o} (${n})}`):(i.body&&(Array.isArray(i.body)?a=i.body:i.body.data&&Array.isArray(i.body.data)&&(a=i.body.data)),lib.log.debug(`[CONTENT.getDynamicData] ${o} (length:${a.length}) (${n})}`))),{statusCode:n,data:a}},getCurrentEpg:async()=>{let t=null,s=null,o=null;const i=(new Date).toISOString().replace(/[^0-9]/g,"").substr(0,10),n=`${e}/epg/${i}`;lib.log.debug(`[CONTENT.getCurrentEpg}] => ${n}`);try{t=await lib.api({url:n}).get()}catch(e){lib.log.error(`[CONTENT.getCurrentEpg] KO ${n} => ${e.message||e.toString()}`)}return t&&(200!==(s=t.statusCode)?lib.log.warning(`[CONTENT.getCurrentEpg] KO ${n} (${s})}`):(o=t.body,lib.log.debug(`[CONTENT.getCurrentEpg] ${n} (length:${o.length}) (${s})}`))),{statusCode:s,data:o}},setUserTag:async({token:s,uuid:o,tag:i,type:n})=>{let a=null,r=null;const l=t({token:s}),d=`${e}/users/${o}/tags/${i}?type=${n}`;lib.log.debug(`[CONTENT.setUserTag}] => ${d} (${JSON.stringify(l)})`);try{if(401===(a=await lib.api({url:d,headers:l}).post()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(l=t({token:e.token}),a=await lib.api({url:d,headers:l}).post())}}catch(e){lib.log.error(`[CONTENT.setUserTag] KO ${d} => ${e.message||e.toString()}`)}return a&&(200!==(r=a.statusCode)?lib.log.warning(`[CONTENT.setUserTag] KO ${d} (${r})}`):lib.log.debug(`[CONTENT.setUserTag] ${d} (${r})}`)),{statusCode:r}},listUserTags:async({token:s,uuid:o})=>{if(SETTINGS.SAFE_MODE)return lib.log.debug("[CONTENT.listUserTags] listUserTags in safe mode"),{statusCode:200,tags:[]};{let i=null,n=null,a=null,r=t({token:s});const l=`${e}/users/${o}/tags`;lib.log.debug(`[CONTENT.listUserTags}] => ${l} (${JSON.stringify(r)})`);try{if(401===(i=await lib.api({url:l,headers:r}).get()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(r=t({token:e.token}),i=await lib.api({url:l,headers:r}).get())}}catch(e){lib.log.error(`[CONTENT.listUserTags] KO ${l} => ${e.message||e.toString()}`)}return i&&(200!==(n=i.statusCode)?lib.log.warning(`[CONTENT.listUserTags] KO ${l} (${n})}`):(a=i.body?i.body.data:null,lib.log.debug(`[CONTENT.listUserTags] ${l} (${n})}`))),{statusCode:n,tags:a}}},listUserVideoTags:async({token:s,uuid:o,id:i})=>{if(SETTINGS.SAFE_MODE)return lib.log.debug("[CONTENT.listUserVideoTags] listUserVideoTags in safe mode"),{statusCode:200,tags:[]};{let n=null,a=null,r=null,l=t({token:s});const d=`${e}/users/${o}/videos/${i}/tags`;lib.log.debug(`[CONTENT.listUserVideoTags}] => ${d} (${JSON.stringify(l)})`);try{if(401===(n=await lib.api({url:d,headers:l}).get()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(l=t({token:e.token}),n=await lib.api({url:d,headers:l}).get())}}catch(e){lib.log.error(`[CONTENT.listUserVideoTags] KO ${d} => ${e.message||e.toString()}`)}return n&&(200!==(a=n.statusCode)?lib.log.warning(`[CONTENT.listUserVideoTags] KO ${d} (${a})}`):(r=n.body||[],lib.log.debug(`[CONTENT.listUserVideoTags] OK ${d} (${a})}`))),{statusCode:a,tags:r}}},setUserVideo:async({token:s,uuid:o,id:i,type:n})=>{let a=null,r=null,l=t({token:s});const d=`${e}/users/${o}/videos/${i}?type=${n}`;lib.log.debug(`[CONTENT.setUserVideo}] => ${d} (${JSON.stringify(l)})`);try{if(401===(a=await lib.api({url:d,headers:l}).post()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(l=t({token:e.token}),a=await lib.api({url:d,headers:l}).post())}}catch(e){lib.log.error(`[CONTENT.setUserVideo] KO ${d} => ${e.message||e.toString()}`)}return a&&(200!==(r=a.statusCode)?lib.log.warning(`[CONTENT.setUserVideo] KO ${d} (${r})}`):lib.log.debug(`[CONTENT.setUserVideo] OK ${d} (${r})}`)),{statusCode:r}},deleteUserVideo:async({token:s,uuid:o,id:i,type:n})=>{let a=null,r=null,l=t({token:s});const d=`${e}/users/${o}/videos/${i}?type=${n}`;lib.log.debug(`[CONTENT.deleteUserVideo}] => ${d} (${JSON.stringify(l)})`);try{if(401===(a=await lib.api({url:d,headers:l}).delete()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(l=t({token:e.token}),a=await lib.api({url:d,headers:l}).delete())}}catch(e){lib.log.error(`[CONTENT.deleteUserVideo] KO ${d} => ${e.message||e.toString()}`)}return a&&(200!==(r=a.statusCode)?lib.log.warning(`[CONTENT.deleteUserVideo] KO ${d} (${r})}`):lib.log.debug(`[CONTENT.deleteUserVideo] OK ${d} (${r})}`)),{statusCode:r}}}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>({core:{login:async({email:e,password:t})=>{e=e?e.toLowerCase():e;let s=null,o=null,i=null;const n=SETTINGS.CORE_API_LOGIN_URL,a={email:e,password:t};lib.log.debug(`[CORE.login] ${e} (${t.replace(/./g,"*")})`);try{s=await lib.api({url:n}).post(a)}catch(t){lib.log.error(`[CORE.login] KO ${e} => ${t.message||t.toString()}`)}if(s)if(o=s.statusCode,200!==s.statusCode)i=s.body.error||"unknow error",lib.log.warning(`[CORE.login] ${e} (${o}) => ${i}`);else if(s.body&&s.body.success&&s.body.success.token&&s.body.success.uuid){const t={uuid:s.body.success.uuid,token:s.body.success.token,key:s.body.success.key,hash:s.body.success.hash,subscription:s.body.subscription,email:e};lib.local.set("session",t),lib.log.info(`[CORE.login] ${e} (${o})} = ${JSON.stringify(t)}`)}else o=null;return{statusCode:o,message:i}},getManifest:async({isLive:e,token:t,videoId:s})=>{let o=null,i=null,n=null,a=null,r=null;const l=e?"getLiveManifest":"getVoDManifest",d=t=>{let o=null;return o=e?`${SETTINGS.CORE_API_GET_LIVE_BASE_URL}/${s}`:`${SETTINGS.CORE_API_GET_VOD_BASE_URL}/${s}`,t&&(o+=`?token=${t}`),o};r=d(t),lib.log.debug(`[CORE.${l}] => ${r}`);try{if(401===(o=await lib.api({url:r}).get()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(r=d(e.token),o=await lib.api({url:r}).get())}}catch(e){n=e.message||e.toString(),lib.log.error(`[CORE.${l}] KO ${r} => ${n}`)}return o&&(200!==(i=o.statusCode)?(n=o.body.error||o.body.message||null,lib.log.warning(`[CORE.${l}] KO ${r} (${i}) => ${n}`)):(a=o.body,lib.log.debug(`[CORE.${l}] ${r} (${i})}`))),{statusCode:i,manifest:a,message:n}},logout:async({token:e})=>{let t=null,s=null;const o=`${SETTINGS.CORE_API_LOGOUT_URL}?token=${e}`;lib.log.debug(`[CORE.logout}] => ${o}`);try{t=await lib.api({url:o}).get()}catch(e){lib.log.error(`[CORE.logout] KO ${o} => ${e.message||e.toString()}`)}return t&&(200!==(s=t.statusCode)?lib.log.error(`[CORE.logout] KO ${o} (${s}) => ${t.body.error||t.body.message||"unknow error"}`):lib.log.debug(`[CORE.logout] ${o} (${s})}`)),{statusCode:s}},checkSession:async({token:e})=>{let t=null,s=null,o=null;const i=`${SETTINGS.CORE_API_CHECK_SESSION_URL}?token=${e}`;lib.log.debug(`[CORE.checkSession}] => ${i}`);try{if(401===(t=await lib.api({url:i}).get()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(t=await lib.api({url:`${SETTINGS.CORE_API_CHECK_SESSION_URL}?token=${e.token}`}).get())}}catch(e){o=e.message||e.toString(),lib.log.error(`[CORE.checkSession] KO ${i} => ${e.message||e.toString()}`)}return t&&(200!==(s=t.statusCode)?(o=t.body.error||t.body.message||null,lib.log.warning(`[CORE.checkSession] KO ${i} (${s}) => ${o||"unknow error"}`)):lib.log.debug(`[CORE.checkSession] ${i} (${s})}`)),{statusCode:s,message:o}},renewSession:async()=>{let e=null,t=null,s=null,o=null;const i=lib.local.get("session");if(i&&i.token&&i.key){const n=i.token,a=i.key,r=SETTINGS.CORE_API_RENEW_SESSION_URL,l={token:i.token,key:i.key};lib.log.info(`[CORE.renewSession] ${a} (${n})`);try{e=await lib.api({url:r}).post(l)}catch(e){lib.log.error(`[CORE.renewSession] KO ${a} => ${e.message||e.toString()}`)}e&&(t=e.statusCode,200!==e.statusCode?(s=e.body.error||"unknow error",lib.log.warning(`[CORE.renewSession] ${a} (${t}) => ${s}`)):e.body&&e.body.success&&e.body.success.email&&e.body.success.token&&e.body.success.uuid?(o={uuid:e.body.success.uuid,token:e.body.success.token,hash:e.body.success.hash,key:e.body.success.key,email:e.body.success.email,subscription:e.body.subscription},lib.local.set("session",o),lib.log.info(`[CORE.renewSession] ${o.email} (${t})} = ${JSON.stringify(o)}`)):t=null)}else lib.log.debug(`[CORE.renewSession] renewsSession without valid previous session => ${i?JSON.stringify(i):"null"}`);return{statusCode:t,message:s,session:o}},listSlots:async({token:e})=>{let t=null,s=null,o=null,i=null;const n=`${SETTINGS.CORE_LIST_SLOTS_URL}?token=${e}`;lib.log.debug(`[CORE.listSlots}] => ${n}`);try{if(401===(t=await lib.api({url:n}).get()).statusCode){const{session:e}=await lib.core.renewSession();e&&e.token&&(t=await lib.api({url:`${SETTINGS.CORE_LIST_SLOTS_URL}?token=${e.token}`}).get())}}catch(e){o=e.message||e.toString(),lib.log.error(`[CORE.listSlots] KO ${n} => ${e.message||e.toString()}`)}return t&&(200!==(s=t.statusCode)?(o=t.body.error||t.body.message||null,lib.log.warning(`[CORE.listSlots] KO ${n} (${s}) => ${o||"unknow error"}`)):(i=t.body.success.slots,lib.log.debug(`[CORE.listSlots] ${n} (${s})}`))),{statusCode:s,message:o,slots:i}},killSlot:async({token:e,slotId:t})=>{let s=null,o=null;const i=`${SETTINGS.CORE_API_KILL_SLOT_URL}?token=${e}&slotId=${t}`;lib.log.debug(`[CORE.killSlot}] => ${i}`);try{s=await lib.api({url:i}).get()}catch(e){lib.log.error(`[CORE.killSlot] KO ${i} => ${e.message||e.toString()}`)}return s&&(200!==(o=s.statusCode)?lib.log.error(`[CORE.killSlot] KO ${i} (${o}) => ${s.body.error||s.body.message||"unknow error"}`):lib.log.debug(`[CORE.killSlot] ${i} (${o})}`)),{statusCode:o}}}}))())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{let t=null;e.localStorage;const s=(e,t=!0)=>{if(e.hasAttribute("data-imgcontainer")){const o=e.querySelector("[data-src]");o&&o.dataset.src&&(o.setAttribute("src",o.dataset.src),t&&e.dataset.imgcontainer&&o.addEventListener("load",()=>{const t=Array.from(document.querySelectorAll(`[data-imgcontainer="${e.dataset.imgcontainer}"]`));t&&t.length&&t.forEach(e=>s(e,!1))}),setTimeout(()=>{o.classList.add("loaded"),e.style.backgroundImage="none",e.removeAttribute("data-imgcontainer")},200))}};return{dom:{removeExpired(){let e=0;const t=Date.now();return Array.from(document.querySelectorAll("[data-expiredOn]")).forEach(s=>{s&&s.dataset&&s.dataset.expiredon&&new Date(s.dataset.expiredon).getTime()<t&&(e++,s.parentElement.removeChild(s),lib.log.debug(`[DOM.removeExpired] removed expired element => ${s.className}`))}),e},listRowsWithEpg:()=>Array.from(document.querySelectorAll('.o-row[data-showepg="true"]')),initImgLazyLoading(){const e=Array.from(document.querySelectorAll("[data-imgcontainer]"));if(lib.browser.supports("IntersectionObserver"))try{t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(t.unobserve(e.target),s(e.target))})},{root:document.getElementsByClassName("main")[0],threshold:0}),e.forEach(e=>t.observe(e))}catch(t){lib.log.warning(`[LAZY] error loading lazy images => ${t.message||t.toString()}`),e.forEach(e=>s(e))}else lib.log.debug("[LAZY] loading all images (fallback)"),Array.from(document.querySelectorAll("[data-imgcontainer]")).forEach(e=>s(e))},addToObserver(e){t&&e.forEach(e=>t.observe(e))}}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{e.localStorage;return{error:{show(e){alert(e)}}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{let t=null;const s=e=>{Array.from(document.querySelectorAll('[data-focus="true"]')).forEach(e=>{e.dataset.focus="false"}),e.dataset.focus="true",e.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})};return{focus:{layout:{init:()=>{e.addEventListener("keydown",e=>{e.code}),(t=Array.from(document.querySelectorAll("[data-focus]"))).length&&s(t[0])}}}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{const t=e.localStorage;return{local:{get:e=>{let s=t.getItem(e);try{s=s?JSON.parse(s):s}catch(t){s=null,lib.log.error(`[LOCAL] invalid json on local key ${e} => ${s}`)}finally{return s}},set:(e,s)=>{const o=JSON.stringify(s);return t.setItem(e,o),s},delete:e=>t.removeItem(e)}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{console.warning=console.warn;let t=null;const s=navigator.userAgent,o=SETTINGS.LOG_CURRENT_LEVEL?SETTINGS.LOG_LEVELS.indexOf(SETTINGS.LOG_CURRENT_LEVEL):null;setTimeout(()=>{t=lib.local?lib.local.get("session"):null});const i=(i,n)=>{const a=`[${(()=>{const e=(new Date).toISOString().split("T"),t=e[1].split(".")[0];return`${e[0]} ${t}`})()}] [${i.substring(0,1).toUpperCase()}] ${n}`;(console[i]||console.error)(a),!SETTINGS.DEV&&!e.__LOG__DISABLED__&&SETTINGS.LOG_CURRENT_LEVEL&&SETTINGS.LOG_LEVELS.indexOf(i)>=o&&(async()=>{let o=null;try{const a={platform:"web",userAgent:s,href:e.location.href};t&&Object.assign(a,{uuid:t.uuid,email:t.email}),o=await lib.api({url:SETTINGS.LOG_URL,headers:{Authorization:`Bearer ${SETTINGS.LOG_API_TOKEN}`,"Content-Type":"application/json"}}).post({project_id:SETTINGS.LOG_PROJECT_ID,events:[{level:i,message:n,fields:a}]})}catch(e){console.error(`[LOG] ${o&&o.body?JSON.stringify(o.body):e.message||e.toString()}`)}})()};return{log:{disable:()=>e.__LOG__DISABLED__=!0,debug:i.bind(null,"debug"),info:i.bind(null,"info"),warning:i.bind(null,"warning"),error:i.bind(null,"error"),catchUnhandled(e){let t=e.reason?e.reason:e,s=`[UNHANDLED] ${t.message||t.toString()}`;t.stack&&(s+=` (${t.stack})`),i("error",s),SETTINGS.DEV&&alert(s)}}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{const t=()=>{const e=document.querySelector(".m-modal");e&&e.parentElement.removeChild(e)};return{modal:{show:async({type:s,extraData:o})=>new Promise(i=>{const n=(({type:t,extraData:s,callback:o})=>{const i={};return"sessionExpired"===t?(i.message="Votre session a expiré",i.btnText="Se rendre sur la page d’ouverture de session",e.TEMP.modal={confirm:()=>e.location.assign(`${SETTINGS.BASE_URL}/login`)}):"coreError"===t?(i.message=`error returned by core (${s.statusCode})`,i.btnText="Continuer",e.TEMP.modal={confirm:()=>o()}):"safeMode"===t?(i.message="Fonction non disponible",i.btnText="Continuer",e.TEMP.modal={confirm:()=>o()}):"browserNotSupported"===t?(i.message="Vous utilisez un navigateur non autorisé. Nous vous prions de le mettre à jour pour vivre une meilleure expérience sur Téléfoot.",i.btnText="Continuer",e.TEMP.modal={confirm:()=>o()}):"error"===t?(i.message=s.message,i.btnText="Continuer",e.TEMP.modal={confirm:()=>o()}):"logout"===t?(i.message="Êtes-vous sûre?",i.btnText="Fermer la session",i.btnCancel="Annuler",e.TEMP.modal={confirm:()=>o(!0),cancel:()=>o(!1)}):"notEnoughRights"===t?(i.message="Votre abonnement n’autorise pas la lecture de ce contenu",i.btnText="Se rendre à la boutique",i.btnCancel="Annuler",e.TEMP.modal={confirm:()=>o(!0),cancel:()=>o(!1)}):"requireLogin"===t?(i.message="Ce contenu n’est disponible que pour les utilisateurs enregistrés",i.btnText="Ouvrir une session",i.btnCancel="Annuler",i.inviteToBuy=!0,e.TEMP.modal={confirm:()=>o(!0),cancel:()=>o(!1)}):"concurrentPlays"===t?(i.message="Le nombre maximal de lectures simultanées a été atteint. Rendez-vous dans la rubrique de paramétrage du site pour gérer vos dispositifs.",i.btnText='Aller dans "Paramètres"',i.btnCancel="Annuler",e.TEMP.modal={confirm:()=>o(!0),cancel:()=>o(!1)}):alert(`invalid modal type: ${t}`),i})({type:s,extraData:o,callback:e=>{t(),i(e)}});t(),((e,t)=>{const s=document.createElement("div");s.className="m-modal",s.innerHTML=`<div class="m-modal__container"><div class="m-modal__innerContent"><div class="m-modal__logoContainer"><img class="m-modal__logo" src="assets/img/logo-landscape-20200801.svg" /></div><div class="m-modal__content">${e}</div>\n        \n        ${t&&t.inviteToBuy?`<div class="m-modal__inviteToBuy">\n          <p>Vous ne possédez toujours pas de compte?</p>\n          <a class="u-button" href="${SETTINGS.SHOP_URL.replace("{platform}","web")}" target="_blank">Créer un compte</a>\n        </div>`:""}\n        </div></div>`,document.body.appendChild(s)})(`<p>${n.message}</p><div class="m-modal__buttons"><button onclick="window.TEMP.modal.confirm();">${n.btnText}</button>${n.btnCancel?`<button class="u-button--secondary" onclick="window.TEMP.modal.cancel();">${n.btnCancel}</button>`:""}</div>`,{inviteToBuy:"requireLogin"==s})})}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>{let t=!1;const s=()=>{if(t){const o=(100-t.dataset.value)*(.1*Math.random());t.dataset.value=parseFloat(t.dataset.value)+o,t.style.width=`${t.dataset.value}%`,e.requestAnimationFrame(s.bind(null,t))}};return{progress:{start(){t&&document.body.removeChild(t),(t=document.createElement("div")).id="progress",t.dataset.value=0,document.body.appendChild(t),s(t)},stop:async()=>new Promise(s=>{const o=t;t=null,e.requestAnimationFrame(()=>{o.style.width="100%",setTimeout(()=>{document.body.removeChild(o),s()},200)})})}}})())})(window),(e=>{e.lib=Object.assign(e.lib||{},(()=>({utils:{isTouchDevice:()=>"ontouchstart"in e||navigator.msMaxTouchPoints>0,isTV:()=>e.navigator.userAgent&&e.navigator.userAgent.toLowerCase().includes("tizen"),setTVMode(){document.body.classList.add("tv")},toPrettyLocalDatetime:e=>e.toLocaleDateString("default",{month:"numeric",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).replace(","," ").replace("  "," "),toDDMM:e=>`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}`,toHHmm:e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,toYYYYMMDDHHmm:e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}T${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,getRandomInt:e=>Math.floor(Math.random()*Math.floor(e+1)),isMobile:()=>e.innerWidth<=640&&e.innerHeight<=640,debounce:(e,t)=>{let s;return function(...o){clearTimeout(s),s=setTimeout(()=>{e.apply(this,o)},t&&t.delay?t.delay:200)}}}}))())})(window),(e=>{const t={set(e){const t=this.offsetWidth-this.nodes.bar.offsetWidth;this.nodes.bar.style.left=e*t+"px"}},s={onMouseDown(e){const t=this.nodes.bar,s=this;e.preventDefault();let o=e.clientX-t.getBoundingClientRect().left;function i(e){let i=Math.max(e.clientX-o-s.getBoundingClientRect().left,0),n=s.offsetWidth-t.offsetWidth;(i=Math.min(n,i))>n&&(i=n),t.style.left=i+"px",console.log("dispatch"),s.dispatchEvent(new CustomEvent("scroll",{detail:i/n}))}document.addEventListener("mousemove",i),document.addEventListener("mouseup",function e(t){document.removeEventListener("mouseup",e);document.removeEventListener("mousemove",i)})}};Array.from(document.getElementsByClassName("a-scroll")).forEach(e=>{Object.assign(e,{nodes:{bar:e.querySelector(".a-scroll__bar")},state:{isClicked:!1}}),Object.keys(t).forEach(s=>e[s]=t[s].bind(e)),e.nodes.bar.addEventListener("mousedown",s.onMouseDown.bind(e)),e.nodes.bar.ondragstart=function(){return!1}})})(window),(e=>{const t={},s=e=>{Object.assign(e,{nodes:{},state:{}}),Object.keys(t).forEach(s=>e[s]=t[s].bind(e))};Array.from(document.getElementsByClassName("m-pagination")).forEach(s),e._=Object.assign(e._||{},{pagination:s})})(window),(e=>{const t={isInitialized(){return this.state.isInitialized},initYoubora(){if(SETTINGS.YOUBORA_ACCOUNT_CODE&&SETTINGS.YOUBORA_TRANSACTION_CODE&&e.youbora&&e.youbora.Plugin){console.log("youbora initialized");const e=lib.local.get("session");this.state.youboraPlugin=new youbora.Plugin({accountCode:SETTINGS.YOUBORA_ACCOUNT_CODE,username:e&&e.uuid?e.uuid:null,"extraparam.1":"web"}),this.state.data&&(this.state.youboraPlugin.setOptions({"content.transactionCode":SETTINGS.YOUBORA_TRANSACTION_CODE,"content.isLive":this.state.data.isLive,"content.title":this.state.data.id,"content.title2":this.state.data.videoId}),this.state.jwplayerInstance&&this.state.youboraPlugin.setAdapter(new youbora.adapters.JWPlayer(this.state.jwplayerInstance)))}},stopCheckSession(){this.state.checkSessionInterval&&(clearInterval(this.state.checkSessionInterval),this.state.checkSessionInterval=null)},initCheckSession(){this.state.token&&(this.stopCheckSession(),this.state.checkSessionInterval=setInterval(async()=>{const{statusCode:e,message:t}=await lib.core.checkSession({token:this.state.token});if(200!==e){this.stopCheckSession(),this.stopPrintHash();let s=e||"unknown code",o=t||"unknown error";422===e&&(o="Votre session de lecture a été annulée depuis un autre dispositif"),this.dispatchEvent(new CustomEvent("error",{detail:{code:s,message:o}}))}},1e3*SETTINGS.MIN_SESSION_TIME_S))},initPrintHash(){this.state.hash&&!this.state.hashInterval&&SETTINGS.HASH_INTERVAL_MS&&SETTINGS.HASH_DURATION_MS&&(this.state.hashInterval=setInterval(()=>{this.printHash(SETTINGS.HASH_DURATION_MS)},SETTINGS.HASH_INTERVAL_MS))},stopPrintHash(){this.state.hashInterval&&clearInterval(this.state.hashInterval)},init({video:e,manifest:t,session:o}){this.state.token=o?o.token:null,this.state.hash=o?o.hash:null,console.log("jwplayer initialized"),jwplayer.key=SETTINGS.JWPLAYER_KEY;const i={file:t.manifestUrl,image:`${SETTINGS.CDN_BASE_URL}/${e.image}.800x450.jpg`,width:"100%",autostart:!0,aspectratio:"16:9"};t.protData&&t.protData.keySystem&&(t.protData.keySystem.startsWith("com.apple")?i.drm={fairplay:{processSpcUrl:t.protData.licenseUrl,certificateUrl:t.protData.certificate}}:i.drm={widevine:{url:t.protData.licenseUrl}});const n=jwplayer("playerContainer");n.setup(i),n.on("setupError",s.onPlayerEvent.bind(this,"setupError")),n.on("play",s.onPlayerEvent.bind(this,"play")),n.on("pause",s.onPlayerEvent.bind(this,"pause")),n.on("error",s.onPlayerEvent.bind(this,"error")),n.on("fullscreen",s.onPlayerEvent.bind(this,"fullscreen")),n.on("ready",s.onPlayerEvent.bind(this,"ready")),n.on("remove",s.onPlayerEvent.bind(this,"remove")),n.on("playAttemptFailed",s.onPlayerEvent.bind(this,"playAttemptFailed")),this.state.jwplayerInstance=n,this.state.data&&"true"===this.state.data.isLive&&this.initPrintHash()},play({fullscreen:e}){if(this.state.jwplayerInstance){if(this.state.jwplayerInstance.play(),e)try{this.state.jwplayerInstance.setFullscreen(!0)}catch(e){lib.log.error(`[PLAYER] => error setting full screen mode => ${e.message||e.toString()}`)}}else alert("jwplayer not initialized")},remove(){this.state.jwplayerInstance&&this.state.jwplayerInstance.remove()},printHash(e){const t=document.getElementById("playerContainer");if(this.state.hash&&t){let e=document.getElementById("hash");e&&e.parentNode.removeChild(e),(e=e||document.createElement("div")).id="hash",e.innerHTML=this.state.hash;const s=[[0,1],[1,1],[1,0]][lib.utils.getRandomInt(2)];e.style.left=`${Math.abs((s[0]?100:0)-(5+lib.utils.getRandomInt(10)))}%`,e.style.top=`${Math.abs((s[1]?100:0)-(5+lib.utils.getRandomInt(10)))}%`,s[0]&&s[1]?e.style.transform="translate(-100%, -100%)":s[0]?e.style.transform="translate(-100%, 0)":s[1]?e.style.transform="translate(0, -100%)":e.style.removeProperty("transform"),t.appendChild(e),lib.log.debug(`[PLAYER.printHash}] printed hash => ${this.state.hash}`),setTimeout(()=>{e&&e.parentNode.removeChild(e)},SETTINGS.HASH_DURATION_MS)}}},s={onPlayerEvent(e,t){"ready"===e?(this.state.isInitialized=!0,this.initYoubora(),this.dispatchEvent(new CustomEvent("ready"))):"remove"===e?(this.stopCheckSession(),this.stopPrintHash(),this.state.isInitialized=!1,this.dispatchEvent(new CustomEvent("remove"))):"play"===e?(this.dispatchEvent(new CustomEvent("play")),"true"===this.state.data.isLive&&this.initCheckSession()):"pause"===e?(this.stopCheckSession(),this.dispatchEvent(new CustomEvent("pause"))):"error"===e?(this.stopCheckSession(),this.stopPrintHash(),this.dispatchEvent(new CustomEvent("error",{detail:{code:t.code,message:t.message}}))):"failed"===e&&(this.stopCheckSession(),this.stopPrintHash(),this.dispatchEvent(new CustomEvent("playAttemptFailed",{code:t.code,message:t.error&&t.error.message?t.error.message:"unknown error"})))}};Array.from(document.getElementsByClassName("m-player")).forEach(e=>{Object.assign(e,{nodes:{playerContainer:e.querySelector("#m-player__container"),hdnVideo:document.getElementById("hdnVideo")},state:{data:null,jwplayerInstance:null,isInitialized:!1,youboraPlugin:null,checkSessionInterval:null,hashInterval:null,token:null,hash:null}}),e.nodes.hdnVideo&&e.nodes.hdnVideo.value&&(e.state.data=JSON.parse(e.nodes.hdnVideo.value)),Object.keys(t).forEach(s=>e[s]=t[s].bind(e))})})(window),(e=>{const t={resize(){const e=this.nodes.logosAndItems,t=e.getBoundingClientRect(),s=document.documentElement.clientHeight-(t.y+20);e.style.height=`${s}px`},updateActiveDay(e){e&&(this.state.currentActive&&this.state.currentActive.classList.remove("o-epg__day--active"),this.state.currentActive=e,e.classList.add("o-epg__day--active"))}},s={onScrollHorizontal(e){this.nodes.channels.scrollLeft=this.nodes.channels.scrollWidth*e.detail},onChannelsScroll(t){this.state.lastItemsScrollLeft=this.nodes.channels.scrollLeft,this.state.waitingForScrollRefresh||(this.state.waitingForScrollRefresh=!0,e.requestAnimationFrame(()=>{this.state.waitingForScrollRefresh=!1,this.nodes.hours.scrollLeft=this.state.lastItemsScrollLeft,this.nodes.scrollHorizontal&&this.nodes.scrollHorizontal.set(this.nodes.hours.scrollLeft/this.nodes.channels.scrollWidth)}))},onResize(){this.resize()},onDayClick(e){const t=this.nodes.daysArray.indexOf(e),s=this.state.startDayHours[t];s&&(this.updateActiveDay(e),this.nodes.channels.scrollLeft=s.offsetLeft-this.nodes.hours.getBoundingClientRect().x)}};Array.from(document.getElementsByClassName("o-epg")).forEach(o=>{Object.assign(o,{nodes:{logosAndItems:o.querySelector(".o-epg__logosAndItems"),hours:o.querySelector(".o-epg__hours"),channels:o.querySelector(".o-epg__channels"),daysArray:Array.from(o.querySelectorAll(".o-epg__day")),marker:o.querySelector(".o-epg__marker"),scrollHorizontal:o.querySelector(".a-scroll--horizontal")},state:{waitingForScrollRefresh:!1,lastItemsScrollLeft:null,startDayHours:[],currentActive:null,minDateStartHour:o.querySelector("#minDateStartHour").value}}),Object.keys(t).forEach(e=>o[e]=t[e].bind(o)),o.nodes.channels.addEventListener("scroll",s.onChannelsScroll.bind(o)),e.addEventListener("resize",s.onResize.bind(o)),e.addEventListener("load",s.onResize.bind(o)),o.nodes.daysArray.forEach(e=>{e.addEventListener("click",s.onDayClick.bind(o,e))}),o.nodes.scrollHorizontal&&o.nodes.scrollHorizontal.addEventListener("scroll",s.onScrollHorizontal.bind(o));let i=0;if([...document.querySelectorAll("time:empty")].forEach(e=>{const t=(e=>{const t=e.toLocaleTimeString().split(":");return`${t[0].padStart(2,"0")}:${t[1].padStart(2,"0")}`})(new Date(e.dateTime));e.innerHTML=t,e.classList.contains("o-epg__hourTime")&&("00:00"===t||e.classList.contains("o-epg__hourTime--first"))&&(e.parentNode.classList.add(".o-epg__hour--startOfDay"),e.parentNode.dataset.day=i,o.state.startDayHours.push(e.parentNode),i++)}),lib.browser.supports("IntersectionObserver")){const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{const t=o.nodes.daysArray[parseInt(e.target.dataset.day)];e.isIntersecting&&o.updateActiveDay(t)})},{root:o.nodes.slides,threshold:.5});e.addEventListener("load",()=>{o.state.startDayHours.forEach(e=>{t.observe(e)})})}else if(o.nodes.daysArray&&o.nodes.daysArray[0]){const e=o.nodes.daysArray[0];e&&o.updateActiveDay(e)}e.addEventListener("load",()=>{const t=(Date.now()-new Date(o.state.minDateStartHour).getTime())/6e4;if(t>0){o.nodes.marker.style.left=`${t}em`,o.nodes.marker.classList.add("o-epg__marker--visible");const s=parseFloat(e.getComputedStyle(o.nodes.channels).fontSize);o.nodes.channels.scrollLeft=parseFloat(t*s-20*s)}o.state.currentActive=o.querySelector(".o-epg__day--active")})})})(window),(e=>{const t={move(e,t=!1){const s=parseInt(this.nodes.items.scrollWidth/this.state.itemsLength);this.nodes.items.scrollLeft+=.75*s*e},resetScroll(){this.nodes.items.style.scrollBehavior="auto",this.nodes.items.scrollLeft=0,this.nodes.items.style.scrollBehavior="smooth"}},s={onCaretClick(e){this.move(e)}};Array.from(document.getElementsByClassName("o-launcher")).forEach(o=>{if(Object.assign(o,{nodes:{items:o.querySelector(".o-launcher__items"),caretLeft:o.querySelector(".u-caret--left"),caretRight:o.querySelector(".u-caret--right")},state:{itemsLength:o.querySelectorAll(".o-launcher__item").length}}),Object.keys(t).forEach(e=>o[e]=t[e].bind(o)),o.nodes.caretLeft.addEventListener("click",s.onCaretClick.bind(o,-1)),o.nodes.caretRight.addEventListener("click",s.onCaretClick.bind(o,1)),o.state.itemsLength>3){const t=o.querySelector(".o-launcher__item:first-child"),s=o.querySelector(".o-launcher__item:last-child");if(lib.browser.supports("IntersectionObserver")){const i=new IntersectionObserver(e=>{e.forEach(e=>{e.target===t?e.isIntersecting?o.nodes.caretLeft.classList.add("u-caret--hidden"):o.nodes.caretLeft.classList.remove("u-caret--hidden"):e.target===s&&(e.isIntersecting?o.nodes.caretRight.classList.add("u-caret--hidden"):o.nodes.caretRight.classList.remove("u-caret--hidden"))})},{root:o.nodes.items,threshold:.75});e.addEventListener("load",()=>{[t,s].forEach(e=>{i.observe(e)})})}else lib.log.debug("[LAUNCHER] running no-observer version"),o.classList.add("o-launcher--noObserver");e.addEventListener("load",()=>{setTimeout(()=>o.resetScroll(),200)})}})})(window),(e=>{const t={move(e){const t=this.querySelector(".o-row__video:nth-child(1)"),s=this.querySelector(".o-row__video:nth-child(2)");if(t&&s){const o=t.getBoundingClientRect().left,i=s.getBoundingClientRect().left;parseInt(this.nodes.videos.scrollWidth/this.state.videosLength);this.nodes.videos.scrollLeft+=e*(i-o)}},remove(){this.parentNode&&this.parentNode.removeChild(this)},fillWithData(e){if(this.videoHtml){this.nodes.videos.innerHTML=e.map(this.videoHtml).join("");const t=Array.from(this.nodes.videos.querySelectorAll("[data-imgcontainer]"));lib.dom.addToObserver(t),this.resetScroll()}else lib.log.error("[ROW] dynamic row but no videoHtml function defined")},resetScroll(){this.nodes.videos.style.scrollBehavior="auto",this.nodes.videos.scrollLeft=0,this.nodes.videos.style.scrollBehavior="smooth"},setEpg(e){let t=!1;const s=Date.now();(e=e.filter(e=>e.start&&e.end&&new Date(e.start).getTime()<=s&&new Date(e.end).getTime()>s)).forEach(e=>{const o=this.querySelector(`[data-id="${e.channel}"]`),i=o?o.querySelector(".o-row__epg"):null;if(i){const n=o.querySelector("img");let a=0,r=`${e.title}${e.subtitle?` - ${e.subtitle}`:""}`;if(e.start&&e.end){const o=new Date(e.start),l=new Date(e.end),d=o.getTime(),c=l.getTime();a=d&&c&&c>d?100/(c-d)*(s-d):0,r+=` (${lib.utils.toHHmm(o)} - ${lib.utils.toHHmm(l)})`,t=!0,i.title=n.title=r,i.innerHTML=`<div class="o-row__epgProgress${e.live?" o-row__epgProgress--live":""}" style="width:${Math.max(a,5)}%"></div>${e.title}${e.subtitle?` - ${e.subtitle}`:""}`}}}),t&&this.classList.add("o-row--epg")},initDates(){Array.from(this.querySelectorAll("[data-datetime]")).forEach(e=>{e.innerHTML=lib.utils.toPrettyLocalDatetime(new Date(e.dataset.datetime))})}},s={onCaretClick(e){this.move(e)}};Array.from(document.getElementsByClassName("o-row")).forEach(o=>{if(Object.assign(o,{nodes:{videos:o.querySelector(".o-row__videos"),caretLeft:o.querySelector(".u-caret--left"),caretRight:o.querySelector(".u-caret--right")},state:{videosLength:o.querySelectorAll(".o-row__video").length}}),Object.keys(t).forEach(e=>o[e]=t[e].bind(o)),o.nodes.caretLeft.addEventListener("click",s.onCaretClick.bind(o,-1)),o.nodes.caretRight.addEventListener("click",s.onCaretClick.bind(o,1)),o.state.videosLength>3){const t=o.querySelector(".o-row__video:first-child"),s=o.querySelector(".o-row__video:last-child");if(lib.browser.supports("IntersectionObserver")){const i=new IntersectionObserver(e=>{e.forEach(e=>{e.target===t?e.isIntersecting?o.nodes.caretLeft.classList.add("u-caret--hidden"):o.nodes.caretLeft.classList.remove("u-caret--hidden"):e.target===s&&(e.isIntersecting?o.nodes.caretRight.classList.add("u-caret--hidden"):o.nodes.caretRight.classList.remove("u-caret--hidden"))})},{root:o.nodes.videos,threshold:.75});e.addEventListener("load",()=>{[t,s].forEach(e=>{i.observe(e)})})}else lib.log.debug("[ROW] running no-observer version"),o.classList.add("o-row--noObserver");e.addEventListener("load",()=>{if(o.dataset&&"true"===o.dataset.showdate&&o.initDates(),o.dataset&&(o.dataset.private||o.dataset.url)){const e=lib.local.get("session");"true"!==o.dataset.private||e?o.dataset.url&&(async()=>{const{statusCode:t,data:s}=await lib.content.getDynamicData({url:o.dataset.url,token:e?e.token:null,uuid:e?e.uuid:null});200===t&&s&&s.length?o.fillWithData(s):200!==t?(lib.log.warning(`[ROW][${t}] error on dynamic row`),o.remove()):0===s.length&&(lib.log.debug("[ROW][EMPTY] empty dynamic row"),o.remove())})():o.remove()}}),setTimeout(()=>o.resetScroll(),200)}})})(window),(e=>{const t={connectObserver(){this.state.observer&&this.nodes.slideArray.forEach(e=>{this.state.observer.observe(e)})},disconnectObserver(){this.state.observer&&this.state.observer.disconnect()},getCorrection:()=>e.innerWidth<640?0:55,getSlideOffset(){const t=this.nodes.slides.querySelector(".o-slider__slide"),s=e.getComputedStyle(t);return t.clientWidth+2*parseInt(s.marginLeft.replace("px",""))},cancelAutoSlide(){this.state.autoSlideInterval&&clearInterval(this.state.autoSlideInterval)},redraw(){const e=this.nodes.slides;e.style.display="none",e.offsetHeight,e.style.display="block"},move(e,t=!1){!t&&this.cancelAutoSlide();const s=this.getSlideOffset()*e;this.nodes.slides.scrollLeft+=s},getCurrentSlide(){const e=parseInt(this.nodes.slides.scrollWidth/this.nodes.slideArray.length);return parseInt(Math.floor(this.nodes.slides.scrollLeft/e))},setBullet(e){e=parseInt(e),this.nodes.bullets.forEach((t,s)=>{e===s?t.classList.add("o-slider__bullet--current"):t.classList.remove("o-slider__bullet--current")})}},s={onScroll(){this.state.isScrollingTimeout&&clearTimeout(this.state.isScrollingTimeout),this.state.isScrollingTimeout=setTimeout(()=>{this.dispatchEvent(new CustomEvent("scrollEnd"))},100)},onCaretClick(e){this.move(e)},onBulletClick(e){this.cancelAutoSlide();const t=this.nodes.slideArray.length/2,s=parseInt(e.dataset.slide),o=this.getSlideOffset();this.classList.remove("o-slider--smooth");let i=null;i=s<t-1?o*t+o*s:o*(t-1),this.classList.remove("o-slider--smooth"),this.nodes.slides.scrollLeft=i-this.getCorrection(),this.classList.add("o-slider--smooth")},onUserScroll(){this.cancelAutoSlide()}};Array.from(document.getElementsByClassName("o-slider")).forEach(o=>{Object.assign(o,{nodes:{slides:o.querySelector(".o-slider__slides"),slideArray:Array.from(o.querySelectorAll(".o-slider__slide")),spacer:o.querySelector(".o-slider__spacer"),caretLeft:o.querySelector(".u-caret--left"),caretRight:o.querySelector(".u-caret--right"),bullets:Array.from(o.querySelectorAll(".o-slider__bullets > li"))},state:{autoSlideInterval:null,isScrollingTimeout:null}}),Object.keys(t).forEach(e=>o[e]=t[e].bind(o)),o.nodes.slides.addEventListener("scroll",s.onScroll.bind(o)),o.nodes.caretLeft.addEventListener("click",s.onCaretClick.bind(o,-1)),o.nodes.caretRight.addEventListener("click",s.onCaretClick.bind(o,1)),o.nodes.bullets.forEach(e=>e.addEventListener("click",s.onBulletClick.bind(o,e))),["touchstart","wheel"].forEach(e=>o.nodes.slides.addEventListener(e,s.onUserScroll.bind(o),{once:!0,passive:!0}));const i=o.nodes.slideArray;e.addEventListener("load",()=>{o.redraw(),setTimeout(()=>{o.nodes.slides.scrollLeft=parseInt(o.nodes.slides.scrollWidth/2-o.getCorrection()),setTimeout(()=>{o.classList.add("o-slider--loaded"),o.classList.add("o-slider--smooth"),lib.browser.supports("IntersectionObserver")?(o.state.observer=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const t=o.getSlideOffset();let s=null;const n=parseInt(e.target.dataset.index),a=i.length/2;n===i.length-2?s=t:1===i.length&&(s=t*a),o.addEventListener("scrollEnd",()=>{Array.from(o.querySelectorAll(".o-slider__slide--current")).forEach(e=>{e.classList.remove("o-slider__slide--current")}),e.target.classList.add("o-slider__slide--current"),o.setBullet(e.target.dataset.slide),s&&(o.classList.remove("o-slider--smooth"),o.nodes.slides.scrollLeft=s-o.getCorrection(),o.classList.add("o-slider--smooth"))},{once:!0})}else e.target.classList.remove("o-slider__slide--current")})},{root:o.nodes.slides,threshold:.5}),o.connectObserver(),o.state.autoSlideInterval=setInterval(()=>{"true"!==o.dataset.focus&&o.move(1,!0)},5e3)):(lib.log.debug("[SLIDER] running no-observer version"),o.classList.add("o-slider--noObserver"))})})})})})(window),(e=>{const t={};Array.from(document.getElementsByClassName("o-topbar")).forEach(e=>{Object.assign(e,{nodes:{icons:e.querySelector(".o-topbar__icons"),btnSignIn:e.querySelector("#btnSignIn")},state:{}}),Object.keys(t).forEach(s=>e[s]=t[s].bind(e)),lib.local.get("session")?e.classList.add("o-topbar--loggedIn"):e.classList.add("o-topbar--notLoggedIn")})})(window),(e=>{const t=`${SETTINGS.ONREWIND_API_BASE_URL}/${SETTINGS.ONREWIND_ACCOUNT_KEY}`,s={"x-account-key":SETTINGS.ONREWIND_ACCOUNT_KEY},o={async refresh(e){lib.progress.start();let o=document.getElementById(`tab-${e}`);if(this.nodes.tabItems.forEach(e=>{e.classList.add("o-widget__tab--loading"),e.classList.remove("o-widget__tab--active")}),"home"===this.state.type){let i=null;if("calendar"===e||"results"===e?i=`${t}/stats/fixturesandresults?competitionId=${this.state.parameters.competitionId}&result=true`:"ranking"===e&&(i=`${t}/stats/standings?competitionId=${this.state.parameters.competitionId}`),i){lib.log.debug(`[WIDGET.home] => ${i}`);try{if(response=await lib.api({url:i,headers:s}).get(),"calendar"===e){let e="";response.body.filter(e=>!e.score||null===e.score[0]).slice(0,10).forEach(t=>{const s=new Date(t.date);e+=`<div class="item"><div class="header"><div class="date">${lib.utils.toDDMM(s)}</div><div class="time">${lib.utils.toHHmm(s)}</div><div class="round">j<span>ournée&nbsp;</span>${t.week}</div></div><div class="teams"><div class="team"><img src="${t.teams[0].pictureUrl}" /><div class="teamName">${t.teams[0].shortName}</div></div><div class="team"><img src="${t.teams[1].pictureUrl}" /><div class="teamName">${t.teams[1].shortName}</div></div> \n                </div></div>`}),o.innerHTML=e}else if("results"===e){let e="";response.body.filter(e=>e.score&&null!==e.score[0]).slice(0,10).forEach(t=>{const s=new Date(t.date);e+=`<div class="item"><div class="header"><div class="date">${lib.utils.toDDMM(s)}</div><div class="score">${t.score[0]}:${t.score[1]}</div><div class="round">j<span>ournée&nbsp;</span>${t.week}</div></div><div class="teams"><div class="team"><img src="${t.teams[0].pictureUrl}" /><div class="teamName">${t.teams[0].shortName}</div></div><div class="team"><img src="${t.teams[1].pictureUrl}" /><div class="teamName">${t.teams[1].shortName}</div></div> \n                </div></div>`}),o.innerHTML=e}else if("ranking"===e){let e="";response.body[0].groups[0].standings.sort((e,t)=>e.position-t.position).slice(0,20).forEach(t=>{e+=`<div class="item"><img src="${t.pictureUrl}" /><div class="name">${t.shortName}</div><div class="points">${t.points}</div><div class="position" data-position="${t.position}"></div></div>`}),o.innerHTML=e}}catch(e){message=e.message||e.toString(),lib.log.error(`[WIDGET.home] KO ${i} => ${e.message||e.toString()}`)}finally{lib.progress.stop(),o.classList.remove("o-widget__tab--loading"),o.classList.add("o-widget__tab--active")}}else lib.log.error(`[WIDGET.home] => no url found for tab ${e}}`)}}};Array.from(document.getElementsByClassName("o-widget")).forEach(t=>{Object.assign(t,{nodes:{container:t.querySelector(".o-widget__container"),tabsSelectors:Array.from(t.querySelectorAll(".o-widget__tabSelector")),tabs:Array.from(t.querySelectorAll(".o-widget__tabs")),tabItems:Array.from(t.querySelectorAll(".o-widget__tab"))},state:{type:t.dataset.type.replace("widget@",""),parameters:JSON.parse(t.querySelector(".o-widget__paremeters").innerText)}}),Object.keys(o).forEach(e=>t[e]=o[e].bind(t)),t.nodes.tabsSelectors.forEach(e=>{e.addEventListener("click",s=>{t.nodes.tabs.forEach(e=>{e.classList.add("o-widget__tab--loading")}),t.nodes.tabsSelectors.forEach(e=>{e.classList.remove("o-widget__tabSelector--selected")}),e.classList.add("o-widget__tabSelector--selected"),t.refresh(s.target.dataset.tab)})}),e.addEventListener("load",()=>{"home"===t.state.type&&t.refresh("calendar")})})})(window),"epg"===document.body.id&&(e=>{e.init=(()=>{console.log("epg initialized")})})(window),"layout"===document.body.id&&(e=>{e.init=(()=>{console.log("layout initialized"),e.addEventListener("load",async()=>{lib.dom.initImgLazyLoading();const e=lib.dom.removeExpired();e&&lib.log.debug(`[LAYOUT] removed ${e} expired nodes`);const t=lib.dom.listRowsWithEpg();if(t.length){const{statusCode:e,data:s}=await lib.content.getCurrentEpg();200===e?Array.from(t).forEach(e=>e.setEpg(s)):lib.log.warning("[LAYOUT] can't retrieve EPG")}lib.utils.isTV()&&(lib.utils.setTVMode(),lib.log.debug("[DEVICE] TV detected"),lib.focus.layout.init())})})})(window),"login"===document.body.id&&(e=>{e.init=(()=>{console.log("login initialized");const t={btnSignIn:document.querySelector(".p-login__btnSignIn"),email:document.querySelector(".p-login__email"),password:document.querySelector(".p-login__password"),error:document.querySelector(".p-login__error")},s={error(e){t.error.innerHTML=e},async signIn(){lib.progress.start();const o=t.email.value,i=t.password.value;if(o&&i){const{statusCode:t,message:n}=await lib.core.login({email:o,password:i});200===t?e.location.assign(SETTINGS.BASE_URL):401===t?s.error("Nom d’utilisateur ou mot de passe erroné"):s.error(`error on core (${t}): ${n}`),lib.progress.stop()}}};t.btnSignIn&&t.btnSignIn.addEventListener("click",s.signIn),t.btnSignIn&&e.addEventListener("keydown",e=>{13===e.keyCode&&s.signIn()})})})(window),"settings"===document.body.id&&(e=>{e.init=(()=>{console.log("settings initialized");const t={session:null},s={email:document.querySelector(".p-settings__email"),team:document.querySelector(".p-settings__team"),btnLogout:document.getElementById("btnLogout"),btnLogoutAll:document.getElementById("btnLogoutAll"),btnUpdateTeam:document.getElementById("btnUpdateTeam"),aClientSpace:document.getElementsByClassName("aClientSpace"),slots:document.getElementById("slots")},o={logout:async()=>{if(t.session&&t.session.token){lib.progress.start(),lib.local.delete("session");const{statusCode:s}=await lib.core.logout(t.session);await lib.progress.stop(),200!==s&&await lib.modal.show({type:"coreError",extraData:{statusCode:s}}),e.location.replace(SETTINGS.BASE_URL)}},logoutAll:async()=>{e.alert("not implemented")},updateTeam:async({token:t,uuid:s,tag:o})=>{lib.progress.start();const{statusCode:i}=await lib.content.setUserTag({uuid:s,token:t,tag:o,type:"favteam"});if(200===i)return await lib.progress.stop(),!0;401===i?(await lib.modal.show({type:"sessionExpired"}),e.location.assign(`${SETTINGS.BASE_URL}/login`)):405===i?await lib.modal.show({type:"safeMode"}):await lib.modal.show({type:"error",extraData:{message:`error updating favorite team (${i})`}})},paintSlots:e=>{let t="";e&&e.length&&e.forEach(e=>{t+=`<div data-slotid="${e.slotId}" class="p-settings__device"><div class="p-settings__deviceInfo"><div class="p-settings__deviceName">${e.device}</div><div class="p-settings__deviceStartTime">${new Date(parseInt(e.startTime)).toLocaleString()}</div></div><button class="p-settings__killSlotBtn">Fermer la session sur ce dispositif</button></div>`}),s.slots.innerHTML=t,setTimeout(()=>{Array.from(document.querySelectorAll(".p-settings__killSlotBtn")).forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".p-settings__device");t&&o.killSlot(t)})})},500)},killSlot(e){if(e){const s=e.dataset.slotid;(async()=>{lib.progress.start();const o=t.session.token,{statusCode:i}=await lib.core.killSlot({token:o,slotId:s});200===i&&e.parentElement.removeChild(e),lib.progress.stop()})()}}},i={async onLogout(){await lib.modal.show({type:"logout"})&&o.logout()},async onUpdateTeam(){if(t.session){const e=s.team.options[s.team.selectedIndex].value;if(!isNaN(e)){const i=t.session.token,n=t.session.uuid;await o.updateTeam({token:i,uuid:n,tag:e}),s.btnUpdateTeam.setAttribute("disabled","")}}},onTeamChange(){s.btnUpdateTeam.removeAttribute("disabled")}};s.btnLogout.addEventListener("click",i.onLogout),s.btnUpdateTeam&&s.btnUpdateTeam.addEventListener("click",i.onUpdateTeam),s.team&&s.team.addEventListener("change",i.onTeamChange);let n=lib.local.get("session");n?(async()=>{if(lib.progress.start(),t.session=n,aClientSpace.setAttribute("href",aClientSpace.href.replace("{token}",n.token).replace("{key}",n.key)),s.email.value=n.email,s.team){const e=document.createElement("optgroup");e.label="Ligue 1";const t=document.createElement("optgroup");t.label="Ligue 2",SETTINGS.TEAMS.sort((e,t)=>e.label.localeCompare(t.label)).forEach(s=>{("ligue1"===s.group?e:t).innerHTML+=`<option value="${s.id}">${s.label}</option>`}),s.team.appendChild(e),s.team.appendChild(t)}const[{statusCode:i,tags:a},{statusCode:r,slots:l}]=await Promise.all([lib.content.listUserTags(n),lib.core.listSlots(n)]);lib.progress.stop();if(200===i){const e=a?a.find(e=>"favteam"===e.type):null;if(e){const t=s.team.querySelector("[selected]");t&&t.removeAttribute("selected");const o=s.team.querySelector(`[value="${e.tag}"]`);o&&o.setAttribute("selected","")}}else 401===i?(await lib.modal.show({type:"sessionExpired"}),e.location.assign(`${SETTINGS.BASE_URL}/login`)):405===i?lib.log.debug(`[SETTINGS] safe mode on listing userVideoTags (${i})`):(lib.log.error(`[SETTINGS] error listing user tags (${i})`),s.team.setAttribute("disabled",""));200===r?o.paintSlots(l):401===r?(await lib.modal.show({type:"sessionExpired"}),e.location.assign(`${SETTINGS.BASE_URL}/login`)):lib.log.error(`[SETTINGS] error listing user slots (${r})`)})():(lib.log.warning("[SETTINGS] session json not found"),e.location.replace(SETTINGS.BASE_URL))})})(window),"video"===document.body.id&&(e=>{e.init=(()=>{console.log("video initialized");const t={video:null},s={hdnVideo:document.querySelector("#hdnVideo"),player:document.querySelector(".m-player"),videoDate:document.getElementById("videoDate"),playBtn:document.getElementById("playBtn"),addToListBtn:document.getElementById("addToListBtn"),removeFromListBtn:document.getElementById("removeFromListBtn"),error:document.getElementById("error")},o={paintError({code:e,message:t}){let o="";e&&(o+=`<div class="p-video__errorCode">${e}</div>`),t&&(o+=`<div class="p-video__errorMessage">${t}</div>`),s.error.innerHTML=o},resetIsInList(e){e?(s.addToListBtn&&(s.addToListBtn.style.display="none"),s.removeFromListBtn&&s.removeFromListBtn.style.removeProperty("display")):(s.addToListBtn&&s.addToListBtn.style.removeProperty("display"),s.removeFromListBtn&&(s.removeFromListBtn.style.display="none"))},isFullscreenRecommended:()=>s.player&&s.player.clientWidth<480},i={onStartPlayer(){s.player.isInitialized&&s.player.play({fullscreen:o.isFullscreenRecommended()})},async onAddToListBtn(){if(SETTINGS.SAFE_MODE)await lib.modal.show({type:"safeMode"});else{lib.progress.start();const{statusCode:e}=await lib.content.setUserVideo({id:t.video.id,uuid:n.uuid,token:n.token,type:"list"});lib.progress.stop(),200===e?o.resetIsInList(!0):401===e?await lib.modal.show({type:"sessionExpired"}):await lib.modal.show({type:"error",extraData:{message:`error adding to my list: ${e}`}})}},async onRemoveFromListBtn(){if(SETTINGS.SAFE_MODE)await lib.modal.show({type:"safeMode"});else{lib.progress.start();const{statusCode:e}=await lib.content.deleteUserVideo({id:t.video.id,uuid:n.uuid,token:n.token,type:"list"});lib.progress.stop(),200===e?o.resetIsInList(!1):401===e?await lib.modal.show({type:"sessionExpired"}):await lib.modal.show({type:"error",extraData:{message:`error deleting from my list: ${e}`}})}},onPlayerReady(){s.playBtn.removeAttribute("disabled")},onPlay(){document.body.classList.add("p-video--playing"),s.playBtn.setAttribute("disabled","")},onPause(){document.body.classList.remove("p-video--playing"),s.playBtn.removeAttribute("disabled")},onPlayerError(e){const t=e.detail||{};s.player.remove(),setTimeout(()=>{lib.log.error(`[PLAYER][ERROR] ${t.code} - ${t.message}`),o.paintError(t)})},onPlayAttemptFailed(e){const t=e.detail||{};s.player&&s.player.remove(),setTimeout(()=>{lib.log.error(`[PLAYER][ERROR] play attempt failed => ${t.code} - ${t.message}`),o.paintError(t)})}};let n=lib.local.get("session");if(e.addEventListener("load",()=>{lib.dom.initImgLazyLoading()}),s.playBtn&&s.playBtn.addEventListener("click",i.onStartPlayer),s.addToListBtn&&s.addToListBtn.addEventListener("click",i.onAddToListBtn),s.removeFromListBtn&&s.removeFromListBtn.addEventListener("click",i.onRemoveFromListBtn),s.player&&(s.player.addEventListener("play",i.onPlay),s.player.addEventListener("pause",i.onPause),s.player.addEventListener("error",i.onPlayerError),s.player.addEventListener("ready",i.onPlayerReady),s.player.addEventListener("playAttemptFailed",i.onPlayAttemptFailed)),t.video=JSON.parse(s.hdnVideo.value),(async()=>{const i="true"===t.video.isLive;lib.progress.start();const{statusCode:a,message:r,manifest:l}=await lib.core.getManifest({isLive:i,videoId:t.video.videoId,token:n?n.token:null});if(200===a){if(s.player.init({video:t.video,manifest:l,session:n}),s.playBtn.removeAttribute("disabled"),n&&!i){const{statusCode:e,tags:s}=await lib.content.listUserVideoTags({id:t.video.id,uuid:n.uuid,token:n.token});if(200===e){const e=!!s.find(e=>"list");o.resetIsInList(e)}else 405===e?lib.log.debug(`[VIDEO] safe mode on listing userVideoTags (${e})`):lib.log.error(`[VIDEO] error listing userVideoTags (${e})`)}}else if([401,403].includes(a)&&!n){await lib.modal.show({type:"requireLogin"})&&e.location.assign(`${SETTINGS.BASE_URL}/login`)}else if(401===a)await lib.modal.show({type:"sessionExpired"});else if(403===a){await lib.modal.show({type:"notEnoughRights"})&&e.open(SETTINGS.SHOP_URL,"_blank")}else if(409===a){await lib.modal.show({type:"concurrentPlays"})&&e.open(SETTINGS.WEB_SETTINGS_URL,"_blank")}else o.paintError({code:a,message:r||"unknown error"});lib.progress.stop()})(),s.videoDate){const e=new Date(s.videoDate.dateTime),t=lib.utils.toPrettyLocalDatetime(e);s.videoDate.innerHTML=t}})})(window),"videos"===document.body.id&&(e=>{e.init=(()=>{console.log("videos initialized");const t={txtSearch:document.getElementById("txtSearch"),formSearch:document.getElementById("formSearch")},s={setFocus(){const e=t.txtSearch;e.focus();const s=e.value?e.value.length:0;s&&e.setSelectionRange(s,s)}};formSearch.addEventListener("submit",s=>{t.txtSearch.value&&t.txtSearch.value.length<e.SETTINGS.MIN_SEARCH_LENGTH&&s.preventDefault()}),e.addEventListener("load",()=>{lib.dom.initImgLazyLoading(),lib.utils.isTouchDevice()||s.setFocus()})})})(window);